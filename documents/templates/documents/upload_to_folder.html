{% extends "base.html" %}
{% load static %}

{% block title %}Upload{% if current_folder %} to {{ current_folder.name }}{% endif %}{% endblock %}

{% block content %}
<div class="container py-4">
    <div class="row justify-content-center">
        <div class="col-12 col-md-8 col-lg-6">
            <div class="bg-white rounded shadow-sm p-4">
                <div class="d-flex align-items-center mb-4">
                    <i class="material-icons text-primary me-2" style="font-size: 32px;">cloud_upload</i>
                    <div>
                        <h4 class="mb-0">Upload File</h4>
                        {% if current_folder %}
                        <small class="text-muted">
                            <i class="material-icons" style="font-size: 14px; vertical-align: middle;">folder</i>
                            {{ current_folder.name }}
                        </small>
                        {% endif %}
                    </div>
                </div>
                
                <!-- Breadcrumbs -->
                {% if breadcrumbs %}
                <nav aria-label="breadcrumb" class="mb-4">
                    <ol class="breadcrumb mb-0" style="font-size: 13px;">
                        <li class="breadcrumb-item">
                            <a href="{% url 'documents:drive' %}" class="text-decoration-none">
                                <i class="material-icons" style="font-size: 16px; vertical-align: middle;">home</i>
                                My Drive
                            </a>
                        </li>
                        {% for crumb in breadcrumbs %}
                        <li class="breadcrumb-item {% if forloop.last %}active{% endif %}">
                            {% if forloop.last %}
                                {{ crumb.name }}
                            {% else %}
                                <a href="{% url 'documents:drive_folder' folder_id=crumb.id %}" class="text-decoration-none">{{ crumb.name }}</a>
                            {% endif %}
                        </li>
                        {% endfor %}
                    </ol>
                </nav>
                {% endif %}
                
                <form method="post" enctype="multipart/form-data">
                    {% csrf_token %}
                    
                    <!-- Drop Zone -->
                    <div class="upload-dropzone mb-3" id="dropZone">
                        <i class="material-icons mb-2" style="font-size: 48px; color: #4285f4;">cloud_upload</i>
                        <p class="mb-1">Drag and drop files here</p>
                        <p class="text-muted mb-2">or</p>
                        <label class="btn btn-outline-primary">
                            Browse Files
                            <input type="file" name="file" id="fileInput" class="d-none" required>
                        </label>
                        <div id="selectedFile" class="mt-3 d-none">
                            <div class="d-flex align-items-center justify-content-center gap-2">
                                <i class="material-icons text-success">check_circle</i>
                                <span id="fileName"></span>
                                <button type="button" class="btn btn-link text-danger p-0" onclick="clearFile()">
                                    <i class="material-icons" style="font-size: 18px;">close</i>
                                </button>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Title (optional)</label>
                        <input type="text" name="title" class="form-control" placeholder="Leave blank to use filename">
                    </div>
                    
                    <div class="mb-4">
                        <label class="form-label">Description (optional)</label>
                        <textarea name="description" class="form-control" rows="2" placeholder="Add a description"></textarea>
                    </div>
                    
                    <div class="d-flex gap-2">
                        <a href="{% if current_folder %}{% url 'documents:drive_folder' folder_id=current_folder.id %}{% else %}{% url 'documents:drive' %}{% endif %}" 
                           class="btn btn-light flex-fill">Cancel</a>
                        <button type="submit" class="btn btn-primary flex-fill" id="submitBtn">
                            <i class="material-icons" style="font-size: 18px; vertical-align: middle;">cloud_upload</i>
                            Upload
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<style>
.upload-dropzone {
    border: 2px dashed #d1d5db;
    border-radius: 12px;
    padding: 40px;
    text-align: center;
    background: #f9fafb;
    transition: all 0.3s ease;
    cursor: pointer;
}

.upload-dropzone:hover,
.upload-dropzone.drag-over {
    border-color: #4285f4;
    background: #eff6ff;
}

.upload-dropzone.drag-over {
    border-style: solid;
}
</style>

<script>
const dropZone = document.getElementById('dropZone');
const fileInput = document.getElementById('fileInput');
const selectedFile = document.getElementById('selectedFile');
const fileName = document.getElementById('fileName');

// Click to browse
dropZone.addEventListener('click', (e) => {
    if (e.target.tagName !== 'INPUT' && e.target.tagName !== 'LABEL') {
        fileInput.click();
    }
});

// Drag events
dropZone.addEventListener('dragover', (e) => {
    e.preventDefault();
    dropZone.classList.add('drag-over');
});

dropZone.addEventListener('dragleave', () => {
    dropZone.classList.remove('drag-over');
});

dropZone.addEventListener('drop', (e) => {
    e.preventDefault();
    dropZone.classList.remove('drag-over');
    
    if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        showFileName(e.dataTransfer.files[0].name);
    }
});

// File selected
fileInput.addEventListener('change', (e) => {
    if (e.target.files.length > 0) {
        showFileName(e.target.files[0].name);
    }
});

function showFileName(name) {
    fileName.textContent = name;
    selectedFile.classList.remove('d-none');
}

function clearFile() {
    fileInput.value = '';
    selectedFile.classList.add('d-none');
}

// Form submission
document.querySelector('form').addEventListener('submit', function() {
    document.getElementById('submitBtn').disabled = true;
    document.getElementById('submitBtn').innerHTML = '<i class="material-icons" style="font-size: 18px; vertical-align: middle;">hourglass_empty</i> Uploading...';
});
</script>
{% endblock %}
